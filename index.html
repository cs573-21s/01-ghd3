<!DOCTYPE HTML!>
<html>
	<head>
		<title>Assignment 1</title>
		<meta charset="UTF-8">
		<script src="http://d3js.org/d3.v5.min.js"></script>
	</head>
	<body>
    <p>Assignment 1 - Junying Li</p>
    <p>    
      <button onclick="playAudio()" type="button">Play Music</button>
      <button onclick="pauseAudio()" type="button">Pause Music</button>
    </p>
    
		<svg width="960" height="640" id="mainsvg" class="svgs"></svg>
    <script src="https://d3js.org/d3.v6.min.js"></script>

    <div id = "value"></div>
    <svg id = "vis"></svg>
    
    <!--All voice audios are free resources from SoundfxCenter(http://soundfxcenter.com/).
        This is Christmas is also a free resource from FreeMusicArchive(https://www.freemusicarchive.org/)-->
    <audio id="This is Christmas">
      <source src="Scott Holmes Music - This is Christmas.mp3" type="audio/mpeg">
    </audio>
    <audio id="Female_Merry_Christmas_Sound_Effect">
      <source src="Female_Merry_Christmas_Sound_Effect.mp3" type="audio/mpeg">
    </audio>
    <audio id="Christmas_Santa_Merry_Christmas_Sound_Effect">
      <source src="Christmas_Santa_Merry_Christmas_Sound_Effect.mp3" type="audio/mpeg">
    </audio>
    <audio id="Little_Boy_Saying_Merry_Christmas_Sound_Effect">
      <source src="Little_Boy_Saying_Merry_Christmas_Sound_Effect.mp3" type="audio/mpeg">
    </audio>
    <audio id="Santa_Ho_Ho_Merry_Christmas_Sound_Effect">
      <source src="Santa_Ho_Ho_Merry_Christmas_Sound_Effect.mp3" type="audio/mpeg">
    </audio>
    <audio id="The_Jackson_5_Merry_Christmas_Everybody_Sound_Effect">
      <source src="The_Jackson_5_Merry_Christmas_Everybody_Sound_Effect.mp3" type="audio/mpeg">
    </audio>
    
    

    <script>
      console.log(d3); // test if d3 is loaded
      
      // Add an SVG
      var svg = d3.select(".svgs")
      .style("background-color", "rgba(244,225,229,255)");
      
      // Get started with examples in [tutorialspoint: D3.js - Introduction to SVG](https://www.tutorialspoint.com/d3js/d3js_introduction_to_svg.htm)
      // Add Rectangles
      svg.append("rect")
      .attr("x", 0)
      .attr("y", 60)
      .attr('width', 50)
      .attr('height', 50)
      .style("fill", "rgb(203,183,201)");
      
      // Add Circles
      svg.append("circle")
      .attr("cx", 25)
      .attr("cy", 25)
      .attr("r", 25)
      .style("fill", "rgb(150,179,156)");
      
      // Add Lines
      svg.append("line")
      .attr("x1", 60)
      .attr("y1", 0)
      .attr("x2", 60)
      .attr("y2", 245)
      .attr("stroke", "rgb(146,195,181)")
      .attr("stroke-width", 2);
      
      // Add Polygons
      svg.append("polygon")
      .attr("points", "25, 120 0, 165 50, 165")
      .attr("style", "fill: rgb(145,146,145)");
    
      // Add Ellipses
      svg.append("ellipse")
      .attr("cx", 25)
      .attr("cy", 210)
      .attr("rx", 20)
      .attr("ry", 35)
      .attr("style", "fill: rgb(196,129,54)");
    
      // Add Polylines
      svg.append("polyline")
      .attr("points", "70, 0 80, 0 80, 100 90, 100 90, 200 100, 200 100, 245")
      .attr("style", "fill: none; stroke: rgb(70,136,116); stroke-width: 2");
    
      // Draw a Christmas tree using graphics above
      // Play Christmas music
      var backgroundMusic = document.getElementById('This is Christmas');
      backgroundMusic.volume = 0.6; 
      function playAudio() {
        backgroundMusic.play();
      }
      function pauseAudio() {
        backgroundMusic.pause();
      }
      // Leaves
      svg.append("polygon")
      .attr("points", "450, 140 330, 260 570, 260")
      .attr("style", "fill: rgba(120,152,147,255); stroke: rgb(20, 82, 20); stroke-width: 1");
      svg.append("polygon")
      .attr("points", "450, 140 430, 160 530, 260 570, 260")
      .attr("style", "fill: rgba(139,166,162,255)");
      svg.append("polygon")
      .attr("points", "390, 260 270, 380 630, 380 510, 260")
      .attr("style", "fill: rgba(81,137,128,255); stroke: rgb(20, 82, 20); stroke-width: 1");
      svg.append("polygon")
      .attr("points", "470, 260 590, 380 630, 380 510, 260")
      .attr("style", "fill: rgba(109,155,145,255)");
      svg.append("polygon")
      .attr("points", "330, 380 210, 500 690, 500 570, 380")
      .attr("style", "fill: rgba(36,96,86,255); stroke: rgb(20, 82, 20); stroke-width: 1");
      svg.append("polygon")
      .attr("points", "530, 380 650, 500 690, 500 570, 380")
      .attr("style", "fill: rgba(68,121,109,255)");
    
      // Shadow
      svg.append("ellipse")
      .attr("cx", 450)
      .attr("cy", 580)
      .attr("rx", 100)
      .attr("ry", 30)
      .attr("style", "fill: rgba(239,197,209,255); stroke: pink; stroke-width: 2");
    
      // Root
      svg.append("rect")
      .attr("x", 420)
      .attr("y", 500)
      .attr("width", 60)
      .attr("height", 80)
      .attr("fill", "rgba(130,74,61,255)");
      svg.append("rect")
      .attr("x", 460)
      .attr("y", 500)
      .attr("width", 20)
      .attr("height", 80)
      .attr("fill", "rgba(148,101,89,255)");
    
      // Star
      svg.append("polygon")
      .attr("points", "450, 50 415, 140 500, 80 400, 80 485, 140")
      .attr("style", "fill: rgba(237,190,45,255)");
      svg.append("line")
      .attr("x1", 450)
      .attr("y1", 97)
      .attr("x2", 450)
      .attr("y2", 52)
      .attr("stroke", "rgba(222,166,11,255)")
      .attr("stroke-width", 2);
      svg.append("line")
      .attr("x1", 450)
      .attr("y1", 97)
      .attr("x2", 416)
      .attr("y2", 139)
      .attr("stroke", "rgba(222,166,11,255)")
      .attr("stroke-width", 2);
      svg.append("line")
      .attr("x1", 450)
      .attr("y1", 97)
      .attr("x2", 498)
      .attr("y2", 81)
      .attr("stroke", "rgba(222,166,11,255)")
      .attr("stroke-width", 2);
      svg.append("line")
      .attr("x1", 450)
      .attr("y1", 97)
      .attr("x2", 402)
      .attr("y2", 81)
      .attr("stroke", "rgba(222,166,11,255)")
      .attr("stroke-width", 2);
      svg.append("line")
      .attr("x1", 450)
      .attr("y1", 97)
      .attr("x2", 484)
      .attr("y2", 139)
      .attr("stroke", "rgba(222,166,11,255)")
      .attr("stroke-width", 2);
      // A stick to hold the star
      svg.append("line")
      .attr("x1", 450)
      .attr("y1", 115)
      .attr("x2", 450)
      .attr("y2", 140)
      .attr("stroke", "rgba(222,166,11,255)")
      .attr("stroke-width", 2);
    
      // Ornaments
      svg.append("polyline")
      .attr("points", "360, 230 380, 250 420, 210 440, 230 480, 190 500, 210 510, 200")
      .attr("style", "fill: none; stroke: white; stroke-width: 2");
      svg.append("polyline")
      .attr("points", "320, 330 350, 360 400, 310 430, 340 480, 290 510, 320 540, 290")
      .attr("style", "fill: none; stroke: white; stroke-width: 3");
      svg.append("polyline")
      .attr("points", "260, 450 300, 490 360, 430 400, 470 460, 410 500, 450 560, 390 600, 430 610, 420")
      .attr("style", "fill: none; stroke: white; stroke-width: 4");
      // Define a blur filter. Started from an example in [stackoverflow: how to blur an image on mouseover using d3](https://stackoverflow.com/questions/35745042/how-to-blur-an-image-on-mouseover-using-d3)
      var filter = svg.append("defs")
      .append("filter")
      .attr("id", "blur")
      .append("feGaussianBlur")
      .attr("stdDeviation", 3);      

      function drawBulb(cx, cy, r, color, audioID) {
        svg.append("circle")
        .attr("cx", cx)
        .attr("cy", cy)
        .attr("r", r)
        .style("fill", color)
        .on("mouseover", mouseOver)
        .on("mouseout", mouseOut);  

        function mouseOver() {
          d3.select(this)
          .attr("filter", "url(#blur)");
          var audio = document.getElementById(audioID);
          audio.play(); //Say Merry Christmas.
          }
        function mouseOut() {
          d3.select(this)
          .attr("filter", null);
        }
      }
   
      drawBulb(430, 190, 10, "rgba(249,194,246,255)", "Female_Merry_Christmas_Sound_Effect");
      drawBulb(490, 240, 8, "rgba(246,26,36,255)", "Christmas_Santa_Merry_Christmas_Sound_Effect");
      drawBulb(360, 310, 8, "rgba(246,26,36,255)", "Little_Boy_Saying_Merry_Christmas_Sound_Effect");
      drawBulb(455, 359, 10, "rgba(243,224,228,255)", "Santa_Ho_Ho_Merry_Christmas_Sound_Effect");
      drawBulb(535, 310, 10, "rgba(249,194,246,255)", "The_Jackson_5_Merry_Christmas_Everybody_Sound_Effect");
      drawBulb(555, 345, 8, "rgba(233,190,52,255)", "Female_Merry_Christmas_Sound_Effect");
      drawBulb(386, 430, 10, "rgba(233,190,52,255)", "Christmas_Santa_Merry_Christmas_Sound_Effect");
      drawBulb(301, 460, 9, "rgba(246,26,36,255)", "Little_Boy_Saying_Merry_Christmas_Sound_Effect");
      drawBulb(480, 475, 11, "rgba(249,194,246,255)", "Santa_Ho_Ho_Merry_Christmas_Sound_Effect");
      drawBulb(570, 440, 10, "rgba(243,224,228,255)", "The_Jackson_5_Merry_Christmas_Everybody_Sound_Effect");
      drawBulb(630, 460, 8, "rgba(233,190,52,255)", "Female_Merry_Christmas_Sound_Effect");

      function drawLight(cx, cy, color1, color2, duration) {
        var light = svg.append("ellipse");
        Math.random() >= 0.5 ? repeat1() : repeat2();
      
        function repeat1() {
          light
            .attr("cx", cx)
            .attr("cy", cy)
            .attr("rx", 5)
            .attr("ry", 10)
            .style("fill", color1)
            .transition().duration(duration)
            .style("fill", color1)
            .attr("filter", "url(#blur)")
            .transition().duration(1000)
            .style("fill", color2)
            .attr("filter", null)
            .on("end", repeat1);
        }
        function repeat2() {
          light
            .attr("cx", cx)
            .attr("cy", cy)
            .attr("rx", 5)
            .attr("ry", 10)
            .style("fill", color2)
            .attr("filter", "url(#blur)")
            .transition().duration(1000)
            .style("fill", color1)
            .attr("filter", null)
            .transition().duration(duration)
            .style("fill", color1)
            .attr("filter", "url(#blur)")
            .on("end", repeat2);
        }
      }

      drawLight(380, 250, "rgba(250,195,247,255)", "rgba(242,224,228,255)", 500);
      drawLight(420, 210, "rgba(168,166,105,255)", "rgba(233,190,49,255)", 500);
      drawLight(440, 230, "rgba(198,75,80,255)", "rgba(249,26,39,255)", 500);
      drawLight(480, 190, "rgba(250,195,247,255)", "rgba(242,224,228,255)", 500);
      drawLight(500, 210, "rgba(168,166,105,255)", "rgba(233,190,49,255)", 500);
      drawLight(350, 360, "rgba(250,195,247,255)", "rgba(242,224,228,255)", 500);
      drawLight(400, 310, "rgba(168,166,105,255)", "rgba(233,190,49,255)", 500);
      drawLight(430, 340, "rgba(198,75,80,255)", "rgba(249,26,39,255)", 500);
      drawLight(480, 290, "rgba(250,195,247,255)", "rgba(242,224,228,255)", 500);
      drawLight(510, 320, "rgba(168,166,105,255)", "rgba(233,190,49,255)", 500);
      drawLight(300, 490, "rgba(168,166,105,255)", "rgba(233,190,49,255)", 500);
      drawLight(360, 430, "rgba(198,75,80,255)", "rgba(249,26,39,255)", 500);
      drawLight(400, 470, "rgba(250,195,247,255)", "rgba(242,224,228,255)", 500);
      drawLight(460, 410, "rgba(168,166,105,255)", "rgba(233,190,49,255)", 500);
      drawLight(500, 450, "rgba(198,75,80,255)", "rgba(249,26,39,255)", 500);
      drawLight(560, 390, "rgba(250,195,247,255)", "rgba(242,224,228,255)", 500);
      drawLight(600, 430, "rgba(168,166,105,255)", "rgba(233,190,49,255)", 500);

      // Snow
      // Inspired by an example in [Looping a transition](https://bl.ocks.org/d3noob/bf44061b1d443f455b3f857f82721372)
      function snow(x, y, r, duration) {
        var snowflake = svg.append("circle")
                      .style("fill", "white");
        repeat();
      
        function repeat() {
          snowflake
            .attr("cx", x)
            .attr("cy", y)
            .attr("r", r)
            .transition().duration(duration)
            .attr("cy", y + Math.random() * 640 > 640 ? 640: y + Math.random() * 640)
            .on("end", repeat);
        }
      }

      function blurSnow(x, y, r, duration) {
        var snowflake = svg.append("circle")
                      .style("fill", "rgb(242, 242, 242)");
        repeat();
      
        function repeat() {
          snowflake
            .attr("cx", x)
            .attr("cy", y)
            .attr("r", r)
            .attr("filter", "url(#blur)")
            .transition().duration(duration)
            .attr("cy", y + Math.random() * 640 > 640 ? 640: y + Math.random() * 640)
            .on("end", repeat);
        }
      }

      for (i = 0; i < 100; i++) {
        blurSnow(Math.random() * 960, Math.random() * 640, Math.random() * 3 + 3, Math.random() * 6000 + 3000);
      }
      for (i = 0; i < 250; i++) {
        snow(Math.random() * 960, Math.random() * 640, Math.random() * 3 + 4, Math.random() * 6000 + 3000);
      }

    </script>
	</body>
</html>
